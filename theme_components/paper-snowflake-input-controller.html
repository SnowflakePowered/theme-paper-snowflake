<link rel="import" href="paper-snowflake-dynamic-input-set">
<link rel="import" href="paper-snowflake-controller-selector">
<link rel="import" href="paper-snowflake-profile-selector">
<link rel="import" href="../bower_components/paper-button/paper-button">
<link rel="import" href="paper-fonts">

<polymer-element name="paper-snowflake-input-controller" attributes="selectedController availableControllers availableProfiles">
<template>
  <link rel="stylesheet" type="text/css" href="style/paper-snowflake-input-controller.css"/>

  <div class="controller-menu">
    <div class="controller-selector">
      <paper-snowflake-controller-selector availableControllers="{{availableControllers}}" selectedController="{{selectedController}}"></paper-snowflake-controller-selector>
      <paper-snowflake-profile-selector hidden?="{{!controllerSelected}}" availableProfiles="{{availableProfiles}}" selectedProfile="{{selectedProfile}}" selectedProfileName="{{selectedProfileName}}"></paper-snowflake-profile-selector>
    </div>
    <div class="controller-buttons">
      <paper-button on-tap="{{commitInputChanges}}">Save</paper-button>
    </div>
  </div>
  <div class="inputs" hidden?="{{!profileSelected}}">
    <paper-snowflake-dynamic-input-set on-input-changed="{{inputChanged}}" controller="{{selectedController}}" profile="{{selectedProfile}}" profileName="{{selectedProfileName}}"></paper-snowflake-dynamic-input-set>
  </div>
  <div class="placeholder" hidden?="{{profileSelected}}">
    Select a profile
  </div>
</template>
<script>
  Polymer('paper-snowflake-input-controller', {

    ready: function () {
      window.p = this;
      this.profileSelected = false;
      this.controllerSelected = false;
      this.inputConfigurationValues = {};
    },
    availableProfilesChanged: function(){
      if (Object.getOwnPropertyNames(this.selectedController).length === 0 || Object.getOwnPropertyNames(this.availableProfiles).length === 0){
        this.controllerSelected = false;
      }else{
        this.controllerSelected = true;
      }
      this.inputConfigurationValues = {};
    },
    selectedProfileChanged: function(){
      if (this.selectedProfile === undefined){
        this.profileSelected = false;
      }else{
        this.profileSelected = true;
      }
      this.inputConfigurationValues = {};
    },
    inputChanged: function(e){
      if(this.profileSelected) {
        this.inputConfigurationValues[e.detail.inputName] = e.detail.commitValue;
        console.log("Updated uncommitted input changes " + e.detail.inputName + " = " + e.detail.commitValue);
      }
    },
    commitInputChanges: function(e){
      console.log("Saving input changes");
      snowflake.setInputConfiguration(this.selectedController.ControllerID, this.selectedProfileName, this.inputConfigurationValues)
      .then(function(){
        console.log("Saved input configuration");
      });

    }


  });
</script>
</polymer-element>
