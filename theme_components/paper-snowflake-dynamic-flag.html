
<link rel="import" href="../bower_components/paper-toggle-button/paper-toggle-button">
<link rel="import" href="../bower_components/paper-slider/paper-slider">
<link rel="import" href="../bower_components/paper-dropdown/paper-dropdown">
<link rel="import" href="../bower_components/paper-item/paper-item">
<link rel="import" href="../bower_components/core-menu/core-menu">
<link rel="import" href="../bower_components/paper-dropdown-menu/paper-dropdown-menu">

<link rel="import" href="paper-fonts">

<polymer-element name="paper-snowflake-dynamic-flag" attributes="flag value gameId emulatorName">
  <template>
    <style>
      .flag-container {
        display: flex;
        justify-content: space-between;
        align-items: center;
        padding-top: 20px;
        padding-left: 10px;
        padding-right: 10px;
        font-family: 'Roboto';
      }
      .flag-container-inner {
      }
      #flagDescription {
        margin-bottom: 5px;
      }
      paper-slider, paper-dropdown-menu {
        width: 350px;
      }
    /*  #flaglocked {
        font-size: 0.8em;
        text-transform: uppercase;
        color: #ffffff;
        display: inline;
        background-color: #2196F3;
        border-radius: 3px;
        padding: 3px;
      }
      #flaglocked:after {
        content: 'lockedized';
      }
      #flaglocked:hover:after {
        content: 'reset to default';
      }
      #flaglocked:hover {
        background-color: #F44336;
        cursor: pointer;
      }*/

      #flagDescription {
        margin-right: 5px;
      }
    </style>
    <div class="flag-container">
      <div class="flag-container-inner">
        <div id="flagDescription">{{flag.Description}}</div>
        <button on-tap="{{toggleLock}}" id="flaglocked">{{locked}}</button>
      </div>
      <div id="flagContent"></div>
    </div>
  </template>
  <script>
      Polymer('paper-snowflake-dynamic-flag', {
        ready: function(){
        },
        updateLock: function(){
          this.locked = (localStorage.getItem("unlocked_" + this.gameId + ";" + this.emulatorName + ";" + this.flag.Key) === null);
        },
        toggleLock: function(){
          if(this.locked) {
            console.log("Unlocking");
            localStorage.setItem("unlocked_" + this.gameId + ";" + this.emulatorName + ";" + this.flag.Key, "true");
          }else{
            console.log("Locking");
            localStorage.removeItem("unlocked_" + this.gameId + ";" + this.emulatorName + ";" + this.flag.Key);
          }
          this.updateLock();
        },
        flagChanged: function (){
          if(this.flag.Type === "BOOLEAN_FLAG") {
            this.setToggle();
          }
          if(this.flag.Type === "INTEGER_FLAG") {
            this.setSlider();
          }
          if(this.flag.Type === "SELECT_FLAG") {
            this.setDropdown();
          }
          this.forceRefresh();
        },
        valueChanged: function() {
          this.fire('flag-refresh', {'value': this.value, 'flag': this.flag, 'locked': this.locked });
          this.forceRefresh();
        },
        gameIdChanged: function(){
          this.forceRefresh();
        },
        emulatorNameChanged: function(){
          this.forceRefresh();
        },
        forceRefresh: function() {
          this.async(function() {
            this.updateLock();
          }, null, 100);
        },
        setToggle: function() {
          this.$.flagContent.innerHTML = ""; //clear existing HTML
          this.injectBoundHTML('<paper-toggle-button disabled?="{{locked}}" checked="{{value}}"></paper-toggle-button>',this.$.flagContent);
        },
        setSlider: function() {
          this.$.flagContent.innerHTML = ""; //clear existing HTML
          this.injectBoundHTML('<paper-slider disabled?="{{locked}}" value="{{value}}" min="{{flag.RangeMin}}" max="{{flag.RangeMax}}" editable snaps pin></paper-slider>',this.$.flagContent);
        },
        setDropdown: function() {
          this.injectBoundHTML('\
          <paper-dropdown-menu disabled?="{{locked}}" label="{{flag.Description}}">\
                <paper-dropdown class="dropdown">\
                    <core-menu class="menu" selected="{{value}}">\
                        <template repeat="{{flag.SelectValues}}">\
                          <paper-item>{{Description}}</paper-item>\
                        </template>\
                    </core-menu>\
                </paper-dropdown>\
            </paper-dropdown-menu>', this.$.flagContent);
        }


      });
  </script>
</polymer-element>
