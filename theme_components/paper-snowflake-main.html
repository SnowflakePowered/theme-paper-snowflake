<link rel="import" href="paper-snowflake-state">

<link rel="import" href="paper-snowflake-top">
<link rel="import" href="paper-snowflake-platform-selector">
<link rel="import" href="paper-fonts">
<link rel="import" href="paper-snowflake-games-container">
<link rel="import" href="paper-snowflake-game-details">

<link rel="import" href="../bower_components/core-animation/core-animation">
<link rel="import" href="../bower_components/paper-fab/paper-fab">
<link rel="import" href="../bower_components/paper-dialog/paper-dialog">

<polymer-element name="paper-snowflake-main">
  <template>
    <style>

      :host {
        overflow: hidden;
        -webkit-user-select: none;
        user-select: none;
      }
      paper-snowflake-top {
        height: 100px;
      }
      .selectMain {
        height: 100%;
        display: table;
      }
      paper-snowflake-platform-selector {
        height: inherit;
        display: table-cell;
        min-width: 307px;
        border-right: 1px solid #dedede;
      }
      paper-snowflake-games-container {
        height: 100%;
        width: 99%;
        display: table-cell;
        background-color: white;
      }
      paper-snowflake-top:before {
        position: fixed;
        content: "";
        z-index: 1000;
        pointer-events: none;
        height: 100px;
        width: 100vw;
        margin-left: 307px;
        box-shadow: 0px 1px 5px rgba(0,0,0,0.3);

      }

      paper-snowflake-game-details {
        z-index: 1000000;
      }
      .shown {
        -webkit-animation: slide 1s ease forwards;
      }

      @-webkit-keyframes slide {
        from {
          right: -5000px;
        }
        to {
          right: 0;
        }
      }
      @-webkit-keyframes slide-out {
        from {
          right: 0;
        }
        to {
          right: -5000px;
        }
      }
      .add-button {
        position: absolute;
        right: 25px;
        bottom: 25px;
      }

    </style>
    <paper-dialog id="addGameDialog" heading="Temporary Add Game">
      <input id="addGameFilename" type="text"></input>
      <button on-click="{{addGameButtonClick}}">Add this game</button>
    </paper-dialog>
    <paper-snowflake-state id="state"
      availablePlatforms="{{availablePlatforms}}"
      selectedPlatform="{{selectedPlatform}}"
      selectedPlatformGames="{{selectedPlatformGames}}"
      showingDetails="{{showingDetails}}"
      selectedGame="{{selectedGame}}"
    ></paper-snowflake-state>
    <paper-snowflake-game-details unresolved id="detailsView" coverUrl="{{coverFrontUrl}}" selectedGame="{{selectedGame}}"></paper-snowflake-game-details>
    <paper-snowflake-top unresolved selectedPlatform="{{selectedPlatform}}"></paper-snowflake-top>
    <section unresolved class="selectMain">
      <paper-snowflake-platform-selector selectedPlatform="{{selectedPlatform}}" availablePlatforms="{{availablePlatforms}}"></paper-snowflake-platform-selector>
      <paper-snowflake-games-container on-game-show="{{gameShow}}" selectedGame="{{selectedGame}}" selectedPlatform="{{selectedPlatform}}" selectedPlatformGames="{{selectedPlatformGames}}"></paper-snowflake-games-container>
      <paper-fab class="add-button" on-tap="{{addGame}}"></paper-fab>
    </section>
  </template>
  <script>
    Polymer('paper-snowflake-main', {
      ready: function() {
        window.du = this;
      },
      addGame: function(e) {
        this.$.addGameDialog.open();
      },
      selectedGameChanged: function() {
        this.coverFrontUrl = "http://localhost:30002/"+this.selectedGame.MediaStore.MediaStoreKey+"/images/boxart_front";
      },
      addGameButtonClick: function() {
        var fileName = this.$.addGameFilename.value;
        var platformId = this.selectedPlatform.PlatformID;
        snowflake.getGameResults(fileName, platformId)
        .then(function(data) {
          return snowflake.getGameInfo(data[0].ID, fileName, platformId);
        })
        .then(function(data) {
          console.log (data);
          return snowflake.addGameInfo(data);
        })
        .then(function(data) {
          console.log(data);
        });
      },
      gameShow: function() {
        this.$.detailsView.open();
      }
    });
  </script>
</polymer-element>
